<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="reset.css" />
	<style>
	.container {
		position: relative;
		top: 15%;
		margin: 0 auto;
		font-size: 0.25rem;
		width: 16.2em;
	}
	.keyboard-container td {
		border: 1px solid #dcdfe6;
		text-align: center;
		height: 2em;
		padding: 1em;
		cursor: pointer;
	}
	.screen-container {
		font-size: 0.4rem;
		width: 10.13em;
		height: 2em;
		border: 1px solid #dcdfe6;
		border-bottom: 0;
	}
	.keyboard-container td div {
		width: 2em;
	}
	.screen {
		display: block;
		box-sizing: border-box;
		padding: 0.5em 0.5em 0;
		height: 100%;
		vertical-align: text-bottom;
		text-align: right;
	}
	.active, .equal {
		background-color: #ffcc99;
	}
    </style>
</head>
<body>
	<div id="app" class="container">
		<div class="screen-container">
			<calculator-screen class="screen" :result="calculated"></calculator-screen>
		</div>
		<div class="keyboard-container">
    		<calculator-keyboard :limit-sym="limit" @keyinput="numberInput" @keydelete="deletion" @keyreset="reset" @keysymbol="symbol" @keypercent="percent" @keyequal="equal" @keyswitch="switchSymbol" @keypoint="pointInput"></calculator-keyboard>
    	</div>
    	<div>first value is {{temp.fstNum}} {{typeof(temp.fstNum)}}</div>
    	<div>symbol is {{temp.symbol}}</div>
    	<div>second value is {{temp.sndNum}} {{typeof(temp.sndNum)}}</div>
    	<div>Phase is {{phase}}</div>
	</div>
	<script src="https://unpkg.com/vue"></script>
	<script>
		Vue.component('calculator-screen', {
			template: `<span>{{ result }}</span>`,
			props: ['result']
		});
		Vue.component('calculator-keyboard', {
			template: `
			<table>
    			<tr>
        			<td @click="keyDelete"><div>DEL</div></td>
            		<td @click="keySwitch"><div>+/-</div></td>
            		<td @click="keyPercent"><div>%</div></td>
            		<td @click="keySymbol" :class="{ active: limitSym === '÷' }"><div>÷</div></td>
    			</tr>
    			<tr>
    			    <td @click="keyInput"><div>7</div></td>
    				<td @click="keyInput"><div>8</div></td>
    				<td @click="keyInput"><div>9</div></td>
    				<td @click="keySymbol" :class="{ active: limitSym === '×' }"><div>×</div></td>
    			</tr>
    			<tr>
    			    <td @click="keyInput"><div>4</div></td>
    				<td @click="keyInput"><div>5</div></td>
    				<td @click="keyInput"><div>6</div></td>
    				<td @click="keySymbol" :class="{ active: limitSym === '-' }"><div>-</div></td>
    			</tr>
    			<tr>
    			    <td @click="keyInput"><div>1</div></td>
    				<td @click="keyInput"><div>2</div></td>
    				<td @click="keyInput"><div>3</div></td>
    				<td @click="keySymbol" :class="{ active: limitSym === '+' }"><div>+</div></td>
    			</tr>
    			<tr>
    			    <td @click="keyReset"><div>AC</div></td>
    				<td @click="keyInput"><div>0</div></td>
    				<td @click="keyPoint"><div>.</div></td>
    				<td class="equal" @click="keyEqual"><div>=</div></td>
    			</tr>
			</table>
			`,
			props: ['limitSym'],
			data: function(){
				return {
				};
			},
			methods: {
				keyInput: function() {
					this.$emit('keyinput', event.currentTarget.children[0].innerText);
				},
				keyDelete: function() {
					this.$emit('keydelete');
				},
				keyReset: function() {
					this.$emit('keyreset');
				},
				keySymbol: function() {
					this.$emit('keysymbol', event.currentTarget.children[0].innerText);
				},
				keyPercent: function() {
					this.$emit('keypercent');
				},
				keyEqual: function() {
					this.$emit('keyequal');
				},
				keySwitch: function() {
					this.$emit('keyswitch');
				},
				keyPoint: function() {
					this.$emit('keypoint');
				}
			}
		});
		var calculator = new Vue({
			el: "#app",
			data: {
				calculated: '0',
				temp: {
					fstNum: '0',
					sndNum: '0',
					symbol: ''
				},
				phase: '0',
				type: '0',
				limit: ''
			},
			methods: {
				numberInput: function(param) {
					switch (this.phase) {
						case '0':
						case '4':
						    this.calculated = param;
						    this.temp.fstNum = this.calculated;
						    if(param !== '0') {
						    	this.phase = '1';
						    }
						    break;
						case '1':
						    this.calculated += param;
						    this.temp.fstNum = this.calculated;
						    break;
						case '2':
						    this.calculated = param;
						    this.temp.sndNum = this.calculated;
						    if(param != '0') {
						    	this.phase = '3';
						    }
						    break;
						case '3':
						    this.calculated += param;
						    this.temp.sndNum = this.calculated;
						    break;
						default: 
						    return false;
					}
				},
				deletion: function() {
					switch (this.phase) {
						case '1':
						    this.back();
						    this.temp.fstNum = this.calculated;
						    break;
						case '3':
						    this.back();
						    this.temp.sndNum = this.calculated;
						    break;
						default:
						    return false;
					}
				},
				reset: function() {
					this.calculated = '0';
					this.temp.fstNum = '0';
					this.temp.sndNum = '0';
					this.temp.symbol = '';
					this.phase = '0';
					this.type = '0';
					this.limit = '';
				},
				symbol: function(param) {
					this.temp.symbol = param;
				    this.limit = param;
					switch(this.phase) {
						case '0':
						case '1':
						case '2':
						    this.phase = '2';
						    break;
						case '3':
						    this.phase = '4';
						    break;
						case '4':
						    this.phase = '2';
						    this.temp.fstNum = this.calculated;
						    break;
						default:
						    return false;
					}
				},
				equal: function() {
					switch(this.phase) {
						case '2':
						    this.temp.sndNum = this.temp.fstNum;
						    this.calculation();
						    this.phase = '4';
						    break;
						case '3':
						    this.calculation();
						    this.phase = '4';
						    break;
						default: 
						    return false;
					}
				},
				percent: function() {
					switch(this.phase) {
						case '1':
						    this.calculated = this.calculated/100 + '';
						    this.temp.fstNum = this.calculated;
						    break;
						case '2':
						    if(this.calculated !== '0') {
						    	this.calculated = this.calculated/100 + '';
						        this.temp.fstNum = this.calculated;
						    }
						    break;
						case '3':
						    this.calculated = this.calculated/100 + '';
						    this.temp.sndNum = this.calculated;
						    break;
						case '4':
						    this.calculated = this.calculated/100 + '';
						    break;
						default: 
						    return false;
					}
				},
				switchSymbol: function() {
					switch(this.phase) {
						case '1':
						case '2':
						    this.calculated = 0 - this.calculated + '';
						    this.temp.fstNum = this.calculated;
						    break;
						case '3':
						    this.calculated = 0 - this.calculated + '';
						    this.temp.sndNum = this.calculated;
						    break;
						case '4':
						    this.calculated = 0 - this.calculated + '';
						    break;
						default: 
						    return false;
					}
				},
				pointInput: function() {
					switch(this.phase) {
						case '0':
						case '4':
						    this.calculated = '0.';
						    this.phase = '1';
						    break;
						case '1':
						case '3':
						    if(!this.calculated.match(/\./)) {
						    	this.calculated += '.';
						    }
						    break;
						case '2':
						    this.calculated = '0.';
						    this.phase = '3';
						    break;
						default:
						    return false;
					}
				},
				calculation: function() {
					let processing = this.temp.fstNum + this.temp.symbol + this.temp.sndNum;
					this.calculated = isNaN(eval(processing.replace('×', '*').replace('÷', '/')))?'ERROR':eval(processing.replace('×', '*').replace('÷', '/')) + '';
					this.temp.fstNum = '0';
					this.temp.sndNum = '0';
					this.temp.symbol = '';
					this.limit = '';
				},
				back: function() {
					let strLen = this.calculated.length;
				    if(strLen === 1 || (strLen === 2 && (this.calculated.indexOf('0') === 0 || this.calculated.indexOf('-') === 0)) || (strLen === 3 && this.calculated === '-0.')) {
				    	this.calculated = '0';
				    	this.phase = this.phase - 1 + '';
				    } else {
				    	this.calculated = this.calculated.slice(0, strLen-1);
				    }
				}
			}
		});
	</script>
</body>
</html>